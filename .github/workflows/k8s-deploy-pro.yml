# .github/workflows/deploy.yml

# This workflow is used to deploy the application to the kubernetes cluster in the PRO environment
# The job can deploy the main branch or a tag, if both are provided, the tag will be used
name: Deploy K8s PRO

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to deploy'
        required: false
        default: 'main'
        type: choice
        options:
          - main
      tag:
        description: 'Tag to deploy (takes precedence over branch if both are provided)'
        required: false
      skip_build:
        description: 'Skip bulding and pushing the image to the registry, use when only the deployment has changed'
        required: false
        default: false
        type: boolean
      skip_deploy:
        description: 'Skip deploying the application to the kubernetes cluster, use to test the build or modification of deployment files'
        required: false
        default: false
        type: boolean
      ignore_sonar_failure:
        description: 'Ignore Sonar analysis failure'
        required: false
        default: false
        type: boolean
jobs:
  deploy:
    uses: hocelot/github-cicd/.github/workflows/python-service-deploy-k8s-pro.yml@main
    with:
      deployment_name: ${{ github.event.repository.name }}
      # Pass either tag or branch to the reusable workflow
      branch: ${{ github.event.inputs.branch }}
      tag: ${{ github.event.inputs.tag }}
      ignore_sonar_failure: "${{ github.event.inputs.ignore_sonar_failure }}"
      skip_build: "${{ github.event.inputs.skip_build }}"
      skip_deploy: "${{ github.event.inputs.skip_deploy }}"
    secrets:
      GIT_USER: ${{ secrets.GIT_USER }}
      GIT_TOKEN: ${{ secrets.GIT_TOKEN }}
      SONARCLOUD_TOKEN: ${{ secrets.SONARCLOUD_TOKEN }}
